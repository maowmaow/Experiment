<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
{% load staticfiles %}
<title>Stock trading game - Admin view</title>
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="all" />

<script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
<script src="{% static 'js/angular.min.js' %}"></script>
<script src="{% static 'js/angular-cookies.min.js' %}"></script>
<script src="{% static 'js/angular-resource.min.js' %}"></script>
<script src="{% static 'stock/js/app-stock.js' %}"></script>
</head>
<body ng-app="stockApp">
<header>
	{% csrf_token %}
</header>
<section class="container">
	<h1>Welcome to Stock Trading game!</h1>
	{% if game == None %}
	<div class="alert alert-info">There is no active game session right now. <a href="{% url 'stock:admin_config' %}" class="btn btn-default">Create New Game</a></div>
	{% else %}
	<h4>Current Game Settings <small><a href="{% url 'stock:admin_config' %}">Edit</a></small></h4>
	{% verbatim %}
	<div class="row" ng-controller="adminController">
		<div class="col-md-5">
			<form class="form-inline" role="form">
			<h4>Stock List</h4>
			<table class="table">
				<thead>
					<tr>
						<th>#</th>						
						<th>Stock Name</th>						
						<th>Initial Price</th>
						<th>Initial qty per user</th>						
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="s in stock_list">
						<td>{{$index}}</td>
						<td>{{s.name}}</td>
						<td>{{s.init_price|currency}}</td>
						<td>{{s.init_qty|number}}</td>
					</tr>
				</tbody>
			</table>
			</form>
		</div>
		<div class="col-md-5">
			<form class="form-inline" role="form">
			<h4>User List</h4>
			<table class="table">
				<thead>
					<tr>
						<th>#</th>						
						<th>Email</th>						
						<th>Password</th>
						<th>Cash</th>						
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="p in portfolio_list">
						<td>{{$index}}</td>
						<td>{{p.name}}</td>
						<td>{{p.password}}</td>
						<td>{{p.cash|number}}</td>
					</tr>
				</tbody>
			</table>
			</form>
		</div>
		<div class="col-md-2">
			<p><button type="button" ng-click="startGame()" class="btn btn-lg btn-primary">Start Game</button></p>
			<p><button type="button" ng-click="stopGame()" class="btn btn-lg btn-danger">End Game</button></p>
		</div>
	</div>
	{% endverbatim %}
	{% endif %}
</section>
<footer>
	
</footer>
<script>
stockApp.controller('adminController', ['$scope', '$http', '$window', 'stockSvc', 'portfolioSvc', function($scope, $http, $window, stockSvc, portfolioSvc) {
	$scope.loadStock = function() {
		stockSvc.query(null, function(value) {
			$scope.stock_list = value;	
		});
	};

	$scope.loadPortfolio = function() {
		portfolioSvc.query(null, function(value) {
			$scope.portfolio_list = value;
		});
	};
	
	$scope.startGame = function() {
		$window.open("{% url 'stock:market' %}");
	};
	
	$scope.stopGame = function() {
		
	};
	
	$scope.loadStock();
	$scope.loadPortfolio();
	
}]);
</script>
</body>
</html>