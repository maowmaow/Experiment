<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
{% load staticfiles %}
<title>Stock trading game</title>
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="all" />

<script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
<script src="{% static 'js/angular.min.js' %}"></script>
<script src="{% static 'js/angular-cookies.min.js' %}"></script>
<script src="{% static 'js/angular-resource.min.js' %}"></script>
<script src="{% static 'stock/js/app-stock.js' %}"></script>
</head>
<body ng-app="stockApp">
<header>
	{% csrf_token %}
</header>
{% verbatim %}
<section class="container">
	<h1>Create New Game</h1>
	<div class="row">
		<div class="col-md-6" ng-controller="stockAdminController">
			<h4>Stock List</h4>
			<form class="form-inline" role="form" ng-submit="saveStock()">
			<table class="table">
				<thead>
					<tr>
						<th>#</th>						
						<th>Stock Name</th>						
						<th>Initial Price</th>
						<th>Amount per user</th>
						<th></th>				
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="s in stock_list track by s.pk">
						<td>{{$index + 1}}</td>
						<td>{{s.name}}</td>
						<td>{{s.init_price}}</td>
						<td>{{s.init_qty}}</td>
						<td><a href="#null" ng-click="startEdit(s)">Edit</a></td>
					</tr>
				</tbody>
				<tfoot>
					<tr ng-show="editStock == null">
						<td></td>
						<td><input class="form-control" ng-model="createStock.name" placeholder="Name" style="width:90px" /></td>
						<td><input class="form-control" ng-model="createStock.init_price" placeholder="Price" style="width:90px" /></td>
						<td><input class="form-control" ng-model="createStock.init_qty" placeholder="QTY" style="width:90px" />
							<button class="btn btn-default">Create</button></td>
					</tr>
					<tr ng-show="editStock != null">
						<td></td>
						<td><input class="form-control" ng-model="editStock.name" placeholder="Name" style="width:90px" /></td>
						<td><input class="form-control" ng-model="editStock.init_price" placeholder="Price" style="width:90px" /></td>
						<td><input class="form-control" ng-model="editStock.init_qty" placeholder="QTY" style="width:90px" />
							<button class="btn btn-default">Update</button>
							<button class="btn btn-default" type="button" ng-click="editStock=null">Cancel</button>
						</td>
					</tr>
				</tfoot>
			</table>
			</form>
		</div>
		<div class="col-md-6">
			<form class="form-inline" role="form">
			<h4>User List</h4>
			<table class="table">
				<thead>
					<tr>
						<th>#</th>						
						<th>Email</th>						
						<th>Password</th>
						<th>Cash</th>						
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="p in portfolio_list">
						<td>{{$index}}</td>
						<td>{{p.name}}</td>
						<td>{{p.session}}</td>
						<td>{{p.cash}}</td>
					</tr>
				</tbody>
				<tfoot>
					<tr ng-show="editStock == null">
						<td></td>
						<td><input class="form-control" placeholder="Name" style="width:90px" /></td>
						<td><input class="form-control" placeholder="Password" style="width:90px" /></td>
						<td><input class="form-control" placeholder="Cash" style="width:90px" />
							<button class="btn btn-default">Create</button></td>
					</tr>
					<tr ng-show="editStock != null">
						<td></td>
						<td><input class="form-control" placeholder="Name" style="width:90px" /></td>
						<td><input class="form-control" placeholder="Password" style="width:90px" /></td>
						<td><input class="form-control" placeholder="Cash" style="width:90px" />
							<button class="btn btn-default">Create</button></td>
					</tr>
				</tfoot>
			</table>
			</form>
		</div>
	</div>
	<p class="text-center"><button class="btn btn-lg btn-primary">Create</button></p>
</section>
{% endverbatim %}
<footer>
	
</footer>
<script>
stockApp.controller('stockAdminController', ['$scope', '$http', 'stockSvc', function($scope, $http, stockSvc) {
	
	$scope.createStock = {};
	$scope.editStock = null;
	
	$scope.loadStock = function() {
		stockSvc.query(null, function(value) {
			$scope.stock_list = value;	
		});
	};
	
	$scope.startEdit = function(stock) {
		$scope.editStock = stock;
	};

	$scope.saveStock = function() {
		if ($scope.editStock != null) {
			stockSvc.save({}, $scope.editStock, function() {
				$scope.loadStock();
				$scope.editStock = null;
			});
		} else {
			stockSvc.save({}, $scope.createStock, function() {
				$scope.loadStock();
				$scope.createStock = {};
			});	
		}
	};
	
	$scope.deleteStock = function(stock) {
		stockSvc.delete({ stock_pk:stock.pk }, null, function(value, headers) {
			$scope.loadStock();
		});
	};
	
	$scope.loadStock();
	
}]);
</script>
</body>
</html>