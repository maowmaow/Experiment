<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
{% load staticfiles %}
<title>Stock trading game - Market</title>
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="all" />

<script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
<script src="{% static 'js/angular.min.js' %}"></script>
<script src="{% static 'js/angular-cookies.min.js' %}"></script>
<script src="{% static 'js/angular-resource.min.js' %}"></script>
<script src="{% static 'stock/js/app-stock.js' %}"></script>
</head>
<body>
<section class="container">
	<h1>Market Board</h1>
	{% verbatim %}
	<table class="table table-bordered table-condensed" ng-app="stockApp" ng-controller="marketController">
		<thead>
			<tr>
				<th>Stock Name</th>
				<th>Price</th>
				<th>Cumulative volume</th>
				<th>Bid</th>
				<th>Ask</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="m in market_list track by m.pk">
				<td>{{m.stock}}</td>
				<td>{{m.price|currency}}</td>
				<td>{{m.volume_total|number}}</td>
				<td>{{m.bid|currency}}</td>
				<td>{{m.ask|currency}}</td>
			</tr>
		</tbody>
	</table>
	{% endverbatim %}
</section>
<script>
stockApp.controller('marketController', ['$scope', '$window', '$interval', 'marketSvc', function($scope, $window, $interval, marketSvc) {

	$scope.poll_rate = 500;
	
	$scope.$watch('form.market_price_value', function(newValue) {
		if (newValue == 'MP') {
			$scope.form.market_price = true;
			$scope.form.price = '';
		} else {
			$scope.form.market_price = false;
		}
	});
	
	$scope.loadData = function() {
		marketSvc.query(null, function(value) {
			$scope.market_list = value;
		}, function(httpResponse) {
			$scope.error = httpResponse.data;
		});
	};
	
	$interval(function() { $scope.loadData(); }, $scope.poll_rate);
}]);
</script>
</body>
</html>