<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
{% load staticfiles %}
<title>Ultimatum game - Client view</title>
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="all" />

<script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
<script src="{% static 'js/angular.min.js' %}"></script>
<script src="{% static 'js/angular-cookies.min.js' %}"></script>
<script src="{% static 'js/angular-resource.min.js' %}"></script>
<script src="{% static 'ultimatum/js/app-ultimatum.js' %}"></script>
</head>
<body ng-app="ultimatumApp">
{% verbatim %}
<section class="container" ng-controller="utClientController">
	<h1>Welcome, {{name}}</h1>
	<h2>Please join one of these rooms</h2>
	<div class="list-group">
		<a href="javascript:void(0)" class="list-group-item" ng-repeat="r in room_list" ng-cloak>
			<h4 class="list-group-item-heading">{{r.name}}
				<button ng-hide="{{r.bidder_alias.length > 0}}" type="button" class="btn btn-default btn-xs" ng-click="joinRoom(r, 'bidder')">Join as Bidder</button>
				<button ng-show="{{r.bidder_alias.length > 0}}" type="button" class="btn btn-default btn-xs">Bidder: {{r.bidder_alias}}</button>
				
				<button ng-hide="{{r.receiver_alias.length > 0}}" type="button" class="btn btn-default btn-xs" ng-click="joinRoom(r, 'receiver')">Join as Receiver</button>
				<button ng-show="{{r.receiver_alias.length > 0}}" type="button" class="btn btn-default btn-xs">Receiver: {{r.receiver_alias}}</button>
			</h4>
		</a>
	</div>
</section>
{% endverbatim %}
<footer>
	
</footer>
<script>
ultimatumApp.controller('utClientController', ['$scope', '$http', '$window', 'roomSvc', function($scope, $http, $window, roomSvc) {

	$scope.name = '{{name}}';
	
	$scope.loadRoom = function(pageNo) {
		$scope.room_list = roomSvc.query();
	};

	$scope.joinRoom = function(room, role) {
		roomSvc.save({room_pk:room.pk, action:'join', 'role':role}, null, function(value) {
			$window.location.href = value.url;
		});
	};

	$scope.loadRoom();		
}]);
</script>
</body>
</html>