<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
{% load staticfiles %}
<title>Ultimatum game</title>
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" media="all" />

<script src="{% static 'js/jquery-2.1.0.min.js' %}"></script>
<script src="{% static 'js/angular.js' %}"></script>
<script src="{% static 'js/angular-cookies.js' %}"></script>
<script src="{% static 'js/angular-resource.js' %}"></script>
</head>
<body ng-app="maowmaowApp">
<header>
	{% csrf_token %}
</header>
{% verbatim %}
<section class="container" ng-controller="utAdminController">
	<h1>Create Room</h1>
	<form class="form-horizontal" role="form" ng-submit="createRoom()">
		<div class="form-group">
			<label class="col-sm-2 control-label">Room Name</label>
			<div class="col-sm-10"><input type="text" class="form-control" ng-model="name" /></div>
		</div>
		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<button type="submit" class="btn btn-default">Create</button>
			</div>
		</div>
	</form>
	
	<div class="list-group">
		<a href="javascript:void(0)" class="list-group-item" ng-repeat="r in room_list" ng-cloak>
			<h4 class="list-group-item-heading">{{r.name}} <button type="button" class="btn btn-default btn-xs" ng-click="deleteRoom(r)">Delete</button></h4>
		</a>
	</div>
</section>
{% endverbatim %}
<footer>
	
</footer>
<script>
	var maowmaowApp = angular.module('maowmaowApp', ['ngCookies','ngResource']);
	
	maowmaowApp.config(function($httpProvider) {
		$httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
	});
	
	maowmaowApp.run(function($http, $cookies) {
		$http.defaults.headers.post['X-CSRFToken'] = $cookies['csrftoken'];
		$http.defaults.headers.delete = { 'X-CSRFToken' : $cookies['csrftoken'] };
	});
	
	maowmaowApp.factory('ultimatumSvc', ['$resource', function($resource) {
		return $resource('{% url "ultimatum:api" %}/:pk');
	}]);
	
	maowmaowApp.controller('utAdminController', ['$scope', '$http', 'ultimatumSvc', function($scope, $http, ultimatumSvc) {
		
		$scope.loadRoom = function(pageNo) {
			$scope.room_list = ultimatumSvc.query();
		};

		$scope.createRoom = function() {
			ultimatumSvc.save({}, { name: $scope.name }, function() {
				$scope.loadRoom();
			});
		};
		
		$scope.deleteRoom = function(room) {
			ultimatumSvc.delete({ pk:room.pk }, null, function(value, headers) {
				$scope.loadRoom();
			});
		};
		
		$scope.loadRoom();
		
	}]);
</script>
</body>
</html>